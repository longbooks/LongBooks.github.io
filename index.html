<!DOCTYPE html>
<html>
<head>
    <title>YouTube Data API Quickstart</title>
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script type="text/javascript" src="//www.google.com/jsapi"></script>
    <script type="text/javascript" src="https://apis.google.com/js/client.js?onload=onJSClientLoad"></script>
</head>
<body>
    <div id="login-container" class="pre-auth">
        <a href="#" id="login-link">CLICK ME</a> to continue.
    </div>
    <div class="past-auth">

    </div>
<script>
    (function(){
        var OAUTH_CLIENT_ID='316244741974-m4otm3490uhieom1ovcn0n00v2eq5c9j.apps.googleusercontent.com';
        var OAUTH_SCOPES=['https://www.googleapis.com/auth/yt-analytics.readonly',
                          'https://www.googleapis.com/auth/youtube.readonly',
                          'https://www.googleapis.com/auth/yt-analytics-monetary.readonly'];
        var channelID;

        window.onJSClientLoad=function(){
            gapi.auth.init(function(){
                window.setTimeout(checkAuth,1);
            });};

        function checkAuth(){
            gapi.auth.authorize({
                client_id:OAUTH_CLIENT_ID,
                scope:OAUTH_SCOPES,
                immediate:true
            },handleAuthResult);
        }    

        function handleAuthResult(authResult){
            if(authResult){
                $('pre-auth').hide();
                $('past-auth').show();
                loadAPI();
            }else{
                $('pre-auth').show();
                $('past-auth').hide();
                $('#login-link').click(function()
                {
                    gapi.auth.authorize(
                    {
                        client_id:OAUTH_CLIENT_ID,
                        scope:OAUTH_SCOPES,
                        immediate:false
                    },handleAuthResult);
                });
            }
        }

        function loadAPI(){
            gapi.client.load('youtube','v3',function()
                {
                    gapi.client.load('youtubeAnalytics','v1',function()
                    {
                        getUserChannel();
                    });
                   
                });
        };

        function getUserChannel(){
            var request=gapi.client.youtube.channels.list(
                {
                    mine:true,
                    part:'id,contentDetails'
                });
                request.execute(function(response)
                {
                    if('error' in response){
                        console.log(response.error.message);
                    }else{
                        channelID=response.items[0].id;
                        displayChannelID(channelID);
                    }
                });
        };

        function displayChannelID(chn){
            alert(chn);
        };

    })();


</script>

</body>
</html>
