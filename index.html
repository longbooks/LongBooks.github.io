<!DOCTYPE html>
<html>
    <head>
        <script src="https://accounts.google.com/gsi/client" onload="initClient()" async defer></script>
    </head>
    <body>
        <script>
            var client;
            function initClient() {
                client = google.accounts.oauth2.initCodeClient({
                    client_id: '141290470186-e63pmerr4gft8cep5gptbbjlo3gcqn5u.apps.googleusercontent.com',
                    scope: 'https://www.googleapis.com/auth/youtube.readonly',
                    ux_mode:'popup',
                    callback: (response) => {
                        const xhr=new XMLHttpRequest();
                        xhr.open('POST', 'https://www.googleapis.com/discovery/v1/apis/youtube/v3/rest',true);
                        xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
                        xhr.setRequestHeader('X-Requested-With', 'XmlHttpRequest');
                        xhr.onload=function(){
                            console.log('Auth code response : ' + xhr.responseText);
                        };
                        xhr.send('code=' + code);
                    },
                });
            }

            function execute() {
                return gapi.client.youtube.channels.list({
                    "part":[
                        "snippet,contentDetails,statistics"
                    ],
                    "mine": true
                })
                .then(function(response) {
                    // Handle the results here (response.result has the parsed body).
                    console.log("Response", response);
                },
                function(err) { 
                    console.error("Execute error", err);
                 });
            }
        </script>
        <button onclick="client.requestCode();">authorize and load</button>
        <button onclick="execute()">execute</button>
    </body>
</html>
